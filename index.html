<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>DGKN PIXELBOARD</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    width: 100%;
    background: #111;
    color: #fff;
    font-family: monospace;
    user-select: none;
  }

  header {
    background: #000;
    color: #ffcc00;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    padding: 10px 0;
    border-bottom: 2px solid #222;
    letter-spacing: 2px;
  }

  #ui {
    position: fixed;
    top: 12px;
    right: 12px;
    z-index: 10;
    display: flex;
    gap: 8px;
    align-items: center;
    background: rgba(0,0,0,0.5);
    padding: 6px 10px;
    border-radius: 8px;
  }

  input[type="color"], button {
    cursor: pointer;
    border: none;
    outline: none;
  }

  button {
    background: #333;
    color: #fff;
    padding: 4px 8px;
    border-radius: 5px;
  }

  #resetBtn {
    display: none;
    background: #800;
  }

  canvas {
    display: block;
    width: 100%;
    height: calc(100% - 50px);
    image-rendering: pixelated;
  }
</style>
</head>
<body>
<header>DGKN PIXELBOARD (LIVE)</header>

<div id="ui">
  <input type="color" id="color" value="#ff0000">
  <button id="adminToggle">Admin</button>
  <button id="resetBtn">Alles löschen</button>
</div>

<canvas id="canvas"></canvas>

<!-- ==== Firebase Realtime Sync ==== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";

// === Deine Firebase-Konfiguration ===
const firebaseConfig = {
  apiKey: "AIzaSyAOLfz_Fr1r9U8Wf0WbZsI9cpkdgXpsIXY",
  authDomain: "dgkn-pixelboard.firebaseapp.com",
  databaseURL: "https://dgkn-pixelboard-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "dgkn-pixelboard",
  storageBucket: "dgkn-pixelboard.firebasestorage.app",
  messagingSenderId: "182698688707",
  appId: "1:182698688707:web:b11791968146323d9ae276"
};

// Firebase initialisieren
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// === Board Setup ===
const gridSize = 75;
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const colorPicker = document.getElementById("color");
const adminBtn = document.getElementById("adminToggle");
const resetBtn = document.getElementById("resetBtn");

let admin = false;
const pixelCanvas = document.createElement("canvas");
pixelCanvas.width = gridSize;
pixelCanvas.height = gridSize;
const pctx = pixelCanvas.getContext("2d");

const boardRef = ref(db, "pixels");
let pixels = Array(gridSize * gridSize).fill("#000000");

// Echtzeit-Aktualisierung
onValue(boardRef, snapshot => {
  const data = snapshot.val();
  if (data && Array.isArray(data)) {
    pixels = data;
    applyPixels();
    draw();
  }
});

function applyPixels() {
  for (let i = 0; i < pixels.length; i++) {
    const x = i % gridSize;
    const y = Math.floor(i / gridSize);
    pctx.fillStyle = pixels[i];
    pctx.fillRect(x, y, 1, 1);
  }
}

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - 50;
  draw();
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function draw() {
  ctx.imageSmoothingEnabled = false;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(pixelCanvas, 0, 0, canvas.width, canvas.height);

  const cellW = canvas.width / gridSize;
  const cellH = canvas.height / gridSize;
  ctx.strokeStyle = "#222";
  ctx.lineWidth = 1;
  for (let x = 0; x <= gridSize; x++) {
    const xpos = Math.floor(x * cellW) + 0.5;
    ctx.beginPath();
    ctx.moveTo(xpos, 0);
    ctx.lineTo(xpos, canvas.height);
    ctx.stroke();
  }
  for (let y = 0; y <= gridSize; y++) {
    const ypos = Math.floor(y * cellH) + 0.5;
    ctx.beginPath();
    ctx.moveTo(0, ypos);
    ctx.lineTo(canvas.width, ypos);
    ctx.stroke();
  }
}

// === Klickfunktion ===
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const cx = Math.floor((e.clientX - rect.left) / (canvas.width / gridSize));
  const cy = Math.floor((e.clientY - rect.top) / (canvas.height / gridSize));
  if (cx < 0 || cy < 0 || cx >= gridSize || cy >= gridSize) return;

  const i = cy * gridSize + cx;
  pixels[i] = admin ? "#000000" : colorPicker.value;
  set(boardRef, pixels); // global speichern
});

// === Admin ===
const adminHash = "261e65c62a2ad3234e9f77ac54a6bd0a0c2282d373970ea33cc7df66246cf8df";
async function hash(str) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
}

adminBtn.addEventListener("click", async () => {
  const pwd = prompt("Admin-Passwort:");
  const inputHash = await hash(pwd);
  if (inputHash === adminHash) {
    admin = !admin;
    adminBtn.textContent = admin ? "Admin: ON" : "Admin";
    adminBtn.style.background = admin ? "#800" : "#333";
    resetBtn.style.display = admin ? "inline-block" : "none";
  } else alert("Falsches Passwort");
});

// === Reset (löscht global) ===
resetBtn.addEventListener("click", () => {
  if (!admin) return;
  if (confirm("Wirklich alles löschen?")) {
    pixels = Array(gridSize * gridSize).fill("#000000");
    set(boardRef, pixels);
  }
});
</script>
</body>
</html>
